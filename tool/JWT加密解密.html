<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jwtè§£å¯†/åŠ å¯†</title>
    <!-- å¼•å…¥ jQuery 3.5.1 å›ºå®šåœ°å€ -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <!-- ç¨³å®šå¯ç”¨çš„ jsrsasign åº“CDNï¼Œæ”¯æŒå…¨ç³»åˆ—JWTç®—æ³•å’Œå¯†é’¥ç”Ÿæˆ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/10.9.0/jsrsasign-all-min.js"></script>
    <style>
        :root {
            --primary-color: #007bff;
            --border-color: #ddd;
            --bg-color: #f5f7fa;
            --text-color: #333;
            --success-color: #28a745;
            --error-color: #dc3545;
            --gray-color: #6c757d;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 20px;
            min-width: 900px;
        }

        /* é¡µé¢ä¸»æ ‡é¢˜ */
        h1 {
            text-align: left;
            margin-bottom: 20px;
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.5em;
        }

        /* ä¸‰æ å¼ç½‘æ ¼å¸ƒå±€ */
        .container {
            display: grid;
            grid-template-columns: 1fr 220px 1fr;
            gap: 20px;
            max-width: 1800px;
            margin: 0 auto;
            height: calc(100vh - 80px);
            min-height: 600px;
        }

        /* åŒºåŸŸé€šç”¨æ ·å¼ */
        .section {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .section-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sub-title {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* æ–‡æœ¬æ¡†æ ·å¼ */
        textarea, input[type="text"] {
            width: 100%;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            transition: border-color 0.2s;
        }

        textarea:focus, input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        textarea {
            flex: 1;
            min-height: 80px;
        }

        /* å·¦æ æ ·å¼ */
        .left-panel .token-area {
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }

        /* ä¸­æ æ ·å¼ */
        .center-panel {
            justify-content: flex-start;
            align-items: stretch;
            gap: 15px;
        }

        .alg-select-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .alg-select-group label {
            font-size: 0.9em;
            color: #555;
        }

        select {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }

        .btn {
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.2s;
            width: 100%;
        }

        .btn-encode {
            background-color: #e7f3ff;
            color: #0056b3;
            border: 1px solid #b8daff;
        }

        .btn-encode:hover { background-color: #d0e9ff; }
        .btn-encode:active { background-color: #b8daff; transform: translateY(1px); }

        .btn-decode {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .btn-decode:hover { background-color: #c8e6c9; }
        .btn-decode:active { background-color: #a5d6a7; transform: translateY(1px); }

        .btn-verify {
            background-color: #fff3e0;
            color: #ef6c00;
            border: 1px solid #ffe0b2;
        }

        .btn-verify:hover { background-color: #ffe0b2; }
        .btn-verify:active { background-color: #ffcc80; transform: translateY(1px); }

        .extra-link {
            text-align: center;
            margin-top: 10px;
        }
        
        .extra-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.9em;
            cursor: pointer;
        }
        
        .extra-link a:hover {
            text-decoration: underline;
        }

        /* å³æ æ ·å¼ */
        .right-panel {
            overflow-y: auto;
            gap: 15px;
        }

        .module {
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .module-title {
            font-size: 0.95em;
            font-weight: 600;
            color: #444;
        }

        .icon-btn-group {
            display: flex;
            gap: 5px;
        }

        .icon-btn {
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            color: var(--gray-color);
            padding: 4px 8px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .icon-btn:hover {
            background-color: #f0f0f0;
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .icon-btn:active {
            transform: scale(0.98);
        }

        /* å¯†é’¥åŒºåŸŸæ ·å¼æ§åˆ¶ */
        .key-module {
            display: none;
        }
        .key-module.active {
            display: flex;
        }

        /* Toast æç¤ºæ ·å¼ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            padding: 12px 20px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
        }

        .toast.success { background-color: var(--success-color); }
        .toast.error { background-color: var(--error-color); }
        .toast.info { background-color: var(--primary-color); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            body {
                min-width: unset;
            }
            .container {
                grid-template-columns: 1fr;
                height: auto;
            }
            .section {
                min-height: 300px;
            }
            .center-panel {
                min-height: auto;
                order: -1;
            }
        }
    </style>
</head>
<body>

    <!-- Toast å®¹å™¨ -->
    <div class="toast-container" id="toastContainer"></div>

    <h1>jwtè§£å¯†/åŠ å¯†</h1>

    <div class="container">
        <!-- å·¦æ ï¼šç¼–ç åŒºåŸŸ -->
        <div class="section left-panel">
            <div class="section-title">ç¼–ç åŒºåŸŸ</div>
            <div class="token-area">
                <div class="sub-title">
                    <span>JWT Token</span>
                    <button class="icon-btn" onclick="copyToClipboard('#jwtToken', 'Token')" title="å¤åˆ¶">
                        <span>ğŸ“‹</span>å¤åˆ¶
                    </button>
                </div>
                <textarea id="jwtToken" placeholder="åœ¨æ­¤è¾“å…¥æˆ–ç”Ÿæˆ JWT Token..."></textarea>
            </div>
        </div>

        <!-- ä¸­æ ï¼šæ“ä½œåŒºåŸŸ -->
        <div class="section center-panel">
            <div class="section-title">æ“ä½œåŒºåŸŸ</div>
            
            <div class="alg-select-group">
                <label for="algSelect">ç­¾åç®—æ³•:</label>
                <select id="algSelect">
                    <!-- å¯¹ç§°ç®—æ³• -->
                    <option value="HS256">HS256</option>
                    <option value="HS384">HS384</option>
                    <option value="HS512">HS512</option>
                    <!-- éå¯¹ç§°ç®—æ³• -->
                    <option value="RS256">RS256</option>
                    <option value="RS384">RS384</option>
                    <option value="RS512">RS512</option>
                    <option value="PS256">PS256</option>
                    <option value="PS384">PS384</option>
                    <option value="PS512">PS512</option>
                    <option value="ES256">ES256</option>
                    <option value="ES384">ES384</option>
                    <option value="ES512">ES512</option>
                </select>
            </div>

            <button class="btn btn-encode" onclick="encodeJWT()">â† ç¼–ç </button>
            <button class="btn btn-decode" onclick="decodeJWT()">â†’ è§£ç </button>
            <button class="btn btn-verify" onclick="verifyJWT()">âœ“ æ ¡éªŒ</button>
            
            <!-- <div class="extra-link">
                <a href="javascript:void(0)" onclick="showToast('åŠŸèƒ½å¼€å‘ä¸­...', 'info')">Unixæ—¶é—´äº’è½¬</a>
            </div> -->
        </div>

        <!-- å³æ ï¼šè§£ç åŒºåŸŸ -->
        <div class="section right-panel">
            <div class="section-title">è§£ç åŒºåŸŸ</div>

            <!-- Header æ¨¡å— -->
            <div class="module">
                <div class="module-header">
                    <span class="module-title">å¤´éƒ¨/Header</span>
                    <div class="icon-btn-group">
                        <button class="icon-btn" onclick="randomHeader()" title="éšæœºç”Ÿæˆ">
                            <span>ğŸ”„</span>éšæœº
                        </button>
                        <button class="icon-btn" onclick="copyToClipboard('#jwtHeader', 'Header')" title="å¤åˆ¶">
                            <span>ğŸ“‹</span>å¤åˆ¶
                        </button>
                    </div>
                </div>
                <textarea id="jwtHeader"></textarea>
            </div>

            <!-- Payload æ¨¡å— -->
            <div class="module">
                <div class="module-header">
                    <span class="module-title">è½½è·/Payload</span>
                    <div class="icon-btn-group">
                        <button class="icon-btn" onclick="randomPayload()" title="éšæœºç”Ÿæˆ">
                            <span>ğŸ”„</span>éšæœº
                        </button>
                        <button class="icon-btn" onclick="copyToClipboard('#jwtPayload', 'Payload')" title="å¤åˆ¶">
                            <span>ğŸ“‹</span>å¤åˆ¶
                        </button>
                    </div>
                </div>
                <textarea id="jwtPayload"></textarea>
            </div>

            <!-- å¯¹ç§°å¯†é’¥æ¨¡å—ï¼ˆHSç³»åˆ—ä¸“ç”¨ï¼‰ -->
            <div class="module key-module active" id="symmetricKeyModule">
                <div class="module-header">
                    <span class="module-title">å¯¹ç§°å¯†é’¥</span>
                    <button class="icon-btn" onclick="randomSecret()" title="éšæœºç”Ÿæˆ">
                        <span>ğŸ”„</span>éšæœº
                    </button>
                </div>
                <input type="text" id="jwtSecret" placeholder="è¾“å…¥å¯¹ç§°ç­¾åå¯†é’¥...">
            </div>

            <!-- ç§é’¥æ¨¡å—ï¼ˆéå¯¹ç§°ç®—æ³•ä¸“ç”¨ï¼‰ -->
            <div class="module key-module" id="privateKeyModule">
                <div class="module-header">
                    <span class="module-title">ç§é’¥ (PEMæ ¼å¼)</span>
                    <div class="icon-btn-group">
                        <button class="icon-btn" onclick="randomKeyPair()" title="ç”Ÿæˆå¯¹åº”ç®—æ³•çš„å…¬ç§é’¥å¯¹">
                            <span>ğŸ”„</span>éšæœºç”Ÿæˆ
                        </button>
                        <button class="icon-btn" onclick="copyToClipboard('#jwtPrivateKey', 'ç§é’¥')" title="å¤åˆ¶">
                            <span>ğŸ“‹</span>å¤åˆ¶
                        </button>
                    </div>
                </div>
                <textarea id="jwtPrivateKey" rows="6" placeholder="-----BEGIN PRIVATE KEY-----\nè¾“å…¥æˆ–ç²˜è´´PEMæ ¼å¼ç§é’¥ï¼Œå¤±ç„¦åè‡ªåŠ¨è§£æå…¬é’¥\n-----END PRIVATE KEY-----"></textarea>
            </div>

            <!-- å…¬é’¥æ¨¡å—ï¼ˆéå¯¹ç§°ç®—æ³•ä¸“ç”¨ï¼‰ -->
            <div class="module key-module" id="publicKeyModule">
                <div class="module-header">
                    <span class="module-title">å…¬é’¥ (PEMæˆ–JWKS)</span>
                    <button class="icon-btn" onclick="copyToClipboard('#jwtPublicKey', 'å…¬é’¥')" title="å¤åˆ¶">
                        <span>ğŸ“‹</span>å¤åˆ¶
                    </button>
                </div>
                <textarea id="jwtPublicKey" rows="6" placeholder="-----BEGIN PUBLIC KEY-----\nå…¬é’¥å°†åœ¨è¾“å…¥ç§é’¥åè‡ªåŠ¨å¡«å……\n-----END PUBLIC KEY-----"></textarea>
            </div>
        </div>
    </div>

    <script>
        // ç®—æ³•åˆ†ç±»ï¼šå¯¹ç§°/éå¯¹ç§°
        const SYMMETRIC_ALGS = ['HS256', 'HS384', 'HS512'];
        const ASYMMETRIC_ALGS = ['RS256', 'RS384', 'RS512', 'PS256', 'PS384', 'PS512', 'ES256', 'ES384', 'ES512'];

        // é»˜è®¤ç¤ºä¾‹æ•°æ®
        const defaultHeader = {
            "alg": "HS256",
            "typ": "JWT"
        };

        const defaultPayload = {
            "username": "chuangzaoai.com",
            "sub": "demo",
            "iat": 1772197226,
            "nbf": 1772197226,
            "exp": 1772283626
        };

        const defaultSecret = "chuangzaoai";

        // é¡µé¢åˆå§‹åŒ–
        $(document).ready(function() {
            // åº“åŠ è½½æ ¡éªŒ
            if (typeof KJUR === 'undefined') {
                showToast('JWTä¾èµ–åº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                console.error('jsrsasignåº“åŠ è½½å¤±è´¥ï¼ŒCDNåœ°å€ä¸å¯ç”¨');
            }
            initPage();
            bindEvents();
        });

        /**
         * åˆå§‹åŒ–é¡µé¢å†…å®¹
         */
        function initPage() {
            $('#jwtHeader').val(JSON.stringify(defaultHeader, null, 2));
            $('#jwtPayload').val(JSON.stringify(defaultPayload, null, 2));
            $('#jwtSecret').val(defaultSecret);
            $('#algSelect').val('HS256');
            
            // åˆå§‹åŒ–è¾“å…¥æ¡†æ˜¾ç¤º
            toggleKeyInput('HS256');

            // ç”Ÿæˆé»˜è®¤Token
            if (typeof KJUR !== 'undefined') {
                encodeJWT();
            }
        }

        /**
         * ç»‘å®šäº‹ä»¶ç›‘å¬
         */
        function bindEvents() {
            // ç®—æ³•ä¸‹æ‹‰æ¡†æ”¹å˜
            $('#algSelect').on('change', function() {
                const alg = $(this).val();
                syncAlgToHeader(alg);
                toggleKeyInput(alg);
            });

            // Header æ–‡æœ¬æ¡†æ”¹å˜ -> åŒæ­¥ç®—æ³•ä¸‹æ‹‰æ¡†
            $('#jwtHeader').on('input', function() {
                try {
                    const header = JSON.parse($(this).val());
                    if (header.alg) {
                        $('#algSelect').val(header.alg);
                        toggleKeyInput(header.alg);
                    }
                } catch (e) {
                    // JSONä¸åˆæ³•æ—¶å¿½ç•¥
                }
            });

            // ã€æ–°å¢ã€‘ç§é’¥è¾“å…¥æ¡†å¤±ç„¦/è¾“å…¥äº‹ä»¶ï¼šè‡ªåŠ¨è§£æå…¬é’¥
            $('#jwtPrivateKey').on('blur input', function() {
                const privateKeyPEM = $(this).val().trim();
                // åªæœ‰å½“å†…å®¹çœ‹èµ·æ¥åƒPEMæ ¼å¼æ—¶æ‰è§£æï¼Œé¿å…é¢‘ç¹æŠ¥é”™
                if (privateKeyPEM && privateKeyPEM.includes('-----BEGIN')) {
                    extractPublicKeyFromPrivate(privateKeyPEM);
                }
            });

            // Header/Payload å¤±ç„¦æ—¶è‡ªåŠ¨æ ¼å¼åŒ–
            $('#jwtHeader, #jwtPayload').on('blur', function() {
                formatJson($(this));
            });
        }

        /**
         * ã€æ–°å¢æ ¸å¿ƒåŠŸèƒ½ã€‘ä»ç§é’¥ä¸­æå–å…¬é’¥
         */
        function extractPublicKeyFromPrivate(privateKeyPEM) {
            if (typeof KEYUTIL === 'undefined') return;

            try {
                // 1. è§£æç§é’¥
                const keyObj = KEYUTIL.getKey(privateKeyPEM);
                
                // 2. æ£€æŸ¥æ˜¯å¦ä¸ºç§é’¥å¯¹è±¡ä¸”åŒ…å«å…¬é’¥å‚æ•°
                // jsrsasign è§£æ RSA/EC ç§é’¥åï¼Œå¯¹è±¡å†…éƒ¨å·²åŒ…å«å…¬é’¥ä¿¡æ¯ (n/e æˆ– x/y)
                if (!keyObj.isPrivate) {
                    // è™½ç„¶è¾“å…¥çš„æ˜¯ç§é’¥ï¼Œä½†å¯ä»¥æç¤ºä¸€ä¸‹ï¼Œæˆ–è€…ç»§ç»­
                }

                // 3. ç”Ÿæˆå…¬é’¥PEM
                // ç›´æ¥å°†è§£æå‡ºçš„å¯¹è±¡ä¼ ç»™ getPEMï¼Œå®ƒä¼šè‡ªåŠ¨åˆ¤æ–­å¹¶è¾“å‡ºå…¬é’¥æ ¼å¼
                const publicKeyPEM = KEYUTIL.getPEM(keyObj);
                
                // 4. å¡«å……åˆ°å…¬é’¥è¾“å…¥æ¡†
                $('#jwtPublicKey').val(publicKeyPEM);
                
                // åªæœ‰åœ¨å¤±ç„¦æ—¶æ‰æ˜¾ç¤ºæˆåŠŸæç¤ºï¼Œinputè¿‡ç¨‹ä¸­ä¸æ‰“æ‰°ç”¨æˆ·
                // showToast('å…¬é’¥å·²è‡ªåŠ¨æå–', 'success');
            } catch (e) {
                // è§£æå¤±è´¥æ—¶æ¸…ç©ºå…¬é’¥æ¡†å¹¶æç¤ºï¼ˆä»…åœ¨å†…å®¹å®Œæ•´æ—¶æç¤ºï¼‰
                if (privateKeyPEM.includes('-----END')) {
                    console.error('å…¬é’¥è§£æå¤±è´¥', e);
                    // showToast('ç§é’¥æ ¼å¼æ— æ³•è¯†åˆ«ï¼Œæ— æ³•è‡ªåŠ¨æå–å…¬é’¥', 'error');
                }
            }
        }

        /**
         * åˆ‡æ¢å¯†é’¥è¾“å…¥æ¡†æ˜¾ç¤º
         */
        function toggleKeyInput(alg) {
            if (SYMMETRIC_ALGS.includes(alg)) {
                // å¯¹ç§°ç®—æ³•ï¼šæ˜¾ç¤ºå¯¹ç§°å¯†é’¥ï¼Œéšè—å…¬ç§é’¥
                $('#symmetricKeyModule').addClass('active');
                $('#privateKeyModule').removeClass('active');
                $('#publicKeyModule').removeClass('active');
            } else if (ASYMMETRIC_ALGS.includes(alg)) {
                // éå¯¹ç§°ç®—æ³•ï¼šéšè—å¯¹ç§°å¯†é’¥ï¼Œæ˜¾ç¤ºå…¬ç§é’¥
                $('#symmetricKeyModule').removeClass('active');
                $('#privateKeyModule').addClass('active');
                $('#publicKeyModule').addClass('active');
            }
        }

        /**
         * JWT ç¼–ç åŠŸèƒ½
         */
        function encodeJWT() {
            if (typeof KJUR === 'undefined') {
                showToast('JWTä¾èµ–åº“æœªåŠ è½½ï¼Œæ— æ³•æ‰§è¡Œç¼–ç ', 'error');
                return;
            }
            try {
                const headerStr = $('#jwtHeader').val();
                const payloadStr = $('#jwtPayload').val();
                const alg = $('#algSelect').val();

                // éªŒè¯JSONæ ¼å¼
                const header = JSON.parse(headerStr);
                JSON.parse(payloadStr);

                // è·å–ç­¾åå¯†é’¥/ç§é’¥
                let signKey;
                if (SYMMETRIC_ALGS.includes(alg)) {
                    signKey = $('#jwtSecret').val();
                    if (!signKey) {
                        showToast('è¯·è¾“å…¥å¯¹ç§°å¯†é’¥', 'error');
                        return;
                    }
                } else {
                    signKey = $('#jwtPrivateKey').val();
                    if (!signKey) {
                        showToast('è¯·è¾“å…¥PEMæ ¼å¼ç§é’¥', 'error');
                        return;
                    }
                }

                // ç”ŸæˆJWT
                const token = KJUR.jws.JWS.sign(alg, headerStr, payloadStr, signKey);
                
                $('#jwtToken').val(token);
                showToast('ç¼–ç æˆåŠŸ', 'success');
            } catch (e) {
                showToast('ç¼–ç å¤±è´¥: ' + (e.message || 'JSONæ ¼å¼é”™è¯¯/å¯†é’¥æ— æ•ˆ'), 'error');
                console.error('JWTç¼–ç é”™è¯¯', e);
            }
        }

        /**
         * JWT è§£ç åŠŸèƒ½
         */
        function decodeJWT() {
            if (typeof KJUR === 'undefined') {
                showToast('JWTä¾èµ–åº“æœªåŠ è½½ï¼Œæ— æ³•æ‰§è¡Œè§£ç ', 'error');
                return;
            }
            const token = $('#jwtToken').val().trim();
            if (!token) {
                showToast('è¯·è¾“å…¥ JWT Token', 'error');
                return;
            }

            try {
                // è§£æJWT (ä¸éªŒè¯ç­¾å)
                const jws = KJUR.jws.JWS.parse(token);
                
                // æ ¼å¼åŒ–å¹¶å¡«å……Header
                const headerObj = jws.headerObj || {};
                $('#jwtHeader').val(JSON.stringify(headerObj, null, 2));

                // æ ¼å¼åŒ–å¹¶å¡«å……Payload
                const payloadObj = jws.payloadObj || {};
                $('#jwtPayload').val(JSON.stringify(payloadObj, null, 2));

                // åŒæ­¥ç®—æ³•å’Œè¾“å…¥æ¡†
                if (headerObj.alg) {
                    $('#algSelect').val(headerObj.alg);
                    toggleKeyInput(headerObj.alg);
                }

                showToast('è§£ç æˆåŠŸ', 'success');
            } catch (e) {
                showToast('è§£ç å¤±è´¥: Tokenæ ¼å¼æ— æ•ˆ', 'error');
                console.error('JWTè§£ç é”™è¯¯', e);
            }
        }

        /**
         * JWT æ ¡éªŒåŠŸèƒ½
         */
        function verifyJWT() {
            if (typeof KJUR === 'undefined') {
                showToast('JWTä¾èµ–åº“æœªåŠ è½½ï¼Œæ— æ³•æ‰§è¡Œæ ¡éªŒ', 'error');
                return;
            }
            const token = $('#jwtToken').val().trim();
            const alg = $('#algSelect').val();

            if (!token) {
                showToast('è¯·è¾“å…¥ JWT Token', 'error');
                return;
            }

            try {
                // è·å–éªŒç­¾å¯†é’¥/å…¬é’¥
                let verifyKey;
                if (SYMMETRIC_ALGS.includes(alg)) {
                    verifyKey = $('#jwtSecret').val();
                    if (!verifyKey) {
                        showToast('è¯·è¾“å…¥å¯¹ç§°å¯†é’¥', 'error');
                        return;
                    }
                } else {
                    verifyKey = $('#jwtPublicKey').val();
                    if (!verifyKey) {
                        showToast('è¯·è¾“å…¥PEMæ ¼å¼å…¬é’¥', 'error');
                        return;
                    }
                }

                // éªŒè¯ç­¾å
                const isValid = KJUR.jws.JWS.verify(token, verifyKey, [alg]);

                if (isValid) {
                    showToast('æ ¡éªŒæˆåŠŸ: ç­¾åæœ‰æ•ˆï¼Œå†…å®¹æœªè¢«ç¯¡æ”¹', 'success');
                } else {
                    showToast('æ ¡éªŒå¤±è´¥: ç­¾åæ— æ•ˆæˆ–å†…å®¹è¢«ç¯¡æ”¹', 'error');
                }
            } catch (e) {
                showToast('æ ¡éªŒå‡ºé”™: ' + (e.message || 'å¯†é’¥æ ¼å¼é”™è¯¯/ç®—æ³•ä¸åŒ¹é…'), 'error');
                console.error('JWTæ ¡éªŒé”™è¯¯', e);
            }
        }

        /**
         * å°†ç®—æ³•åŒæ­¥åˆ°Header
         */
        function syncAlgToHeader(alg) {
            try {
                let header = JSON.parse($('#jwtHeader').val() || '{}');
                header.alg = alg;
                header.typ = "JWT";
                $('#jwtHeader').val(JSON.stringify(header, null, 2));
            } catch (e) {
                // Headerä¸åˆæ³•æ—¶ç›´æ¥é‡ç½®ä¸ºæ ‡å‡†æ ¼å¼
                $('#jwtHeader').val(JSON.stringify({ alg: alg, typ: "JWT" }, null, 2));
            }
        }

        /**
         * éšæœºç”ŸæˆHeader
         */
        function randomHeader() {
            const currentAlg = $('#algSelect').val();
            const header = {
                alg: currentAlg,
                typ: "JWT"
            };
            $('#jwtHeader').val(JSON.stringify(header, null, 2));
            showToast('Header å·²æ›´æ–°', 'success');
        }

        /**
         * éšæœºç”ŸæˆPayload
         */
        function randomPayload() {
            const now = Math.floor(Date.now() / 1000);
            const payload = {
                sub: "user_" + Math.random().toString(36).substr(2, 9),
                name: "Random User",
                iss: "https://chuangzaoai.com",
                iat: now,
                nbf: now,
                exp: now + 86400 // 24å°æ—¶åè¿‡æœŸ
            };
            $('#jwtPayload').val(JSON.stringify(payload, null, 2));
            showToast('Payload å·²ç”Ÿæˆ', 'success');
        }

        /**
         * éšæœºç”Ÿæˆå¯¹ç§°å¯†é’¥
         */
        function randomSecret() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
            let secret = '';
            for (let i = 0; i < 32; i++) {
                secret += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            $('#jwtSecret').val(secret);
            showToast('å¯¹ç§°å¯†é’¥å·²ç”Ÿæˆ', 'success');
        }

        /**
         * éšæœºç”Ÿæˆå¯¹åº”ç®—æ³•çš„å…¬ç§é’¥å¯¹
         */
        function randomKeyPair() {
            if (typeof KEYUTIL === 'undefined') {
                showToast('å¯†é’¥ç”Ÿæˆä¾èµ–æœªåŠ è½½', 'error');
                return;
            }
            const alg = $('#algSelect').val();
            let keyPair;

            try {
                // æ ¹æ®ç®—æ³•ç”Ÿæˆå¯¹åº”å¯†é’¥å¯¹
                if (alg.startsWith('RS') || alg.startsWith('PS')) {
                    // RSAç³»åˆ—ç®—æ³•ï¼Œ2048ä½
                    keyPair = KEYUTIL.generateKeypair("RSA", 2048);
                } else if (alg.startsWith('ES')) {
                    // ECç³»åˆ—ç®—æ³•ï¼ŒåŒ¹é…æ›²çº¿
                    const curve = alg === 'ES256' ? 'P-256' : alg === 'ES384' ? 'P-384' : 'P-521';
                    keyPair = KEYUTIL.generateKeypair("EC", curve);
                } else {
                    showToast('å½“å‰ç®—æ³•ä¸æ”¯æŒè‡ªåŠ¨ç”Ÿæˆå¯†é’¥å¯¹', 'error');
                    return;
                }

                // è½¬æ¢ä¸ºPEMæ ¼å¼å¹¶å¡«å……åˆ°è¾“å…¥æ¡†
                const privateKeyPEM = KEYUTIL.getPEM(keyPair.prvKeyObj, "PKCS8PRV");
                const publicKeyPEM = KEYUTIL.getPEM(keyPair.pubKeyObj);
                
                $('#jwtPrivateKey').val(privateKeyPEM);
                $('#jwtPublicKey').val(publicKeyPEM);

                showToast(`${alg} å…¬ç§é’¥å¯¹å·²ç”Ÿæˆ`, 'success');
            } catch (e) {
                showToast('å¯†é’¥ç”Ÿæˆå¤±è´¥: ' + e.message, 'error');
                console.error('å¯†é’¥ç”Ÿæˆé”™è¯¯', e);
            }
        }

        /**
         * å¤åˆ¶åˆ°å‰ªè´´æ¿
         */
        function copyToClipboard(selector, desc) {
            const text = $(selector).val();
            if (!text) {
                showToast('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶', 'error');
                return;
            }
            
            const tempInput = $('<textarea>');
            $('body').append(tempInput);
            tempInput.val(text).select();
            document.execCommand('copy');
            tempInput.remove();
            
            showToast(desc + ' å¤åˆ¶æˆåŠŸ', 'success');
        }

        /**
         * æ ¼å¼åŒ–JSONæ–‡æœ¬æ¡†
         */
        function formatJson($element) {
            const raw = $element.val();
            if (!raw.trim()) return;
            
            try {
                const obj = JSON.parse(raw);
                $element.val(JSON.stringify(obj, null, 2));
            } catch (e) {
                // ä¸åˆæ³•æ—¶ä¸å¤„ç†ï¼Œä¿ç•™ç”¨æˆ·è¾“å…¥
            }
        }

        /**
         * æ˜¾ç¤ºToastæç¤º
         */
        function showToast(message, type = 'info') {
            const $toast = $('<div class="toast ' + type + '">' + message + '</div>');
            $('#toastContainer').append($toast);
            
            setTimeout(function() {
                $toast.fadeOut(300, function() {
                    $(this).remove();
                });
            }, 3000);
        }
    </script>
</body>
</html>